<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grove AI Studio - 模型管理</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/model-management.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css">
</head>
<body>
    <div class="app-container">
        <!-- 左侧导航栏 -->
        <aside class="sidebar">
            <div class="logo">
                <h1>Grove AI Studio</h1>
            </div>
            <nav class="nav-menu">
                <ul>
                    <li><a href="index.html"><i class="ri-dashboard-line"></i> 工作台</a></li>
                    <li class="active"><a href="model-management.html"><i class="ri-apps-line"></i> 模型管理</a></li>
                    <li><a href="local-tools.html"><i class="ri-tools-fill"></i> 本地工具箱</a></li>
                    <li><a href="online-tools.html"><i class="ri-cloud-line"></i> 在线工具箱</a></li>
                    <li><a href="agents.html"><i class="ri-robot-line"></i> 智能体</a></li> 
                </ul>
            </nav>
            <!-- 侧边栏底部的设置按钮 -->
            <div class="sidebar-footer">
                <nav class="nav-menu">
                    <ul>
                        <li><a href="settings.html"><i class="ri-settings-line"></i> 设置</a></li>
                    </ul>
                </nav>
            </div>
        </aside>

        <!-- 主内容区域 -->
        <main class="main-content">
            <!-- 模型管理页面 -->
            <div id="model-management" class="model-management-page active-page">
                <h2>模型管理</h2>
                
                <!-- 设置面板容器 -->
                <div class="settings-layout">
                    <!-- 左侧设置选项卡导航 -->
                    <div class="settings-sidebar">
                        <button class="settings-tab active" data-tab="dialog-models">
                            <span>对话模型</span>
                        </button>
                        <button class="settings-tab" data-tab="vector-models">
                            <span>向量模型</span>
                        </button>
                    </div>
                    
                    <!-- 右侧设置内容区域 -->
                    <div class="settings-content">
                        <!-- 对话模型设置 -->
                        <div id="dialog-models" class="settings-tab-content active">
                            <!-- 对话模型的选项卡 -->
                            <div class="model-subtabs">
                                <button class="model-subtab active" data-subtab="online-models">在线模型</button>
                                <button class="model-subtab" data-subtab="offline-models">离线模型</button>
                            </div>
                            
                            <!-- 在线模型设置 -->
                            <div id="online-models" class="model-subtab-content active">
                                <div class="settings-container" id="online-models-container">
                                    <!-- 在线模型列表 - 示例静态内容 -->
                                    <div class="model-card placeholder-card" data-model-id="placeholder-online-1">
                                        <div class="model-info">
                                            <span class="model-name">示例在线模型 (GPT-4)</span>
                                            <span class="model-provider">提供商: OpenAI</span>
                                        </div>
                                        <div class="model-actions">
                                            <button class="edit-btn"><i class="ri-pencil-line"></i></button>
                                            <button class="delete-btn"><i class="ri-delete-bin-line"></i></button>
                                        </div>
                                    </div>
                                    <div class="empty-state" style="display: none;">
                                        <p>还没有添加在线模型。</p>
                                    </div>
                                </div>
                                <button class="add-model-btn" id="add-online-model">
                                    <i class="ri-add-line"></i> 添加在线模型
                                </button>
                            </div>
                            
                            <!-- 离线模型设置 -->
                            <div id="offline-models" class="model-subtab-content">
                                <!-- 模型存储路径 -->
                                <div class="model-storage-path-container">
                                    <div class="model-storage-path">
                                        <span>模型存储路径:</span>
                                        <span id="model-storage-path">/Users/username/.grovestudio/models</span>
                                    </div>
                                    <div class="path-info">模型将自动存储在上述固定位置</div>
                                </div>
                                
                                <!-- 离线模型选项卡 -->
                                <div class="offline-model-tabs">
                                    <button class="offline-model-tab active" data-offlinetab="huggingface-models">可用模型</button>
                                    <button class="offline-model-tab" data-offlinetab="downloaded-models">已下载模型</button>
                                    <button class="downloads-btn" id="show-downloads">
                                        下载中
                                        <span class="download-count" id="download-count">0</span>
                                    </button>
                                </div>
                                
                                <!-- 可用模型 (Hugging Face) -->
                                <div id="huggingface-models" class="offline-model-tab-content active">
                                    <div class="model-groups-container">
                                        <!-- Llama 3 模型组 -->
                                        <div class="model-group">
                                            <h3 class="model-group-title">Llama 3</h3>
                                            <div class="settings-container">
                                                <div class="model-card" data-model-repo-id="llama3-8b-q4">
                                                    <div class="model-info">
                                                        <span class="model-name">Llama 3 8B Instruct (Q4_K_M)</span>
                                                        <span class="model-file-size">大小: 4.5GB</span>
                                                    </div>
                                                    <div class="model-actions">
                                                        <button class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                                                    </div>
                                                </div>
                                                <div class="model-card" data-model-repo-id="llama3-8b-q5">
                                                    <div class="model-info">
                                                        <span class="model-name">Llama 3 8B Instruct (Q5_K_M)</span>
                                                        <span class="model-file-size">大小: 5.1GB</span>
                                                    </div>
                                                    <div class="model-actions">
                                                        <button class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                                                    </div>
                                                </div>
                                                <div class="model-card" data-model-repo-id="llama3-8b-q8">
                                                    <div class="model-info">
                                                        <span class="model-name">Llama 3 8B Instruct (Q8_0)</span>
                                                        <span class="model-file-size">大小: 8.2GB</span>
                                                    </div>
                                                    <div class="model-actions">
                                                        <button class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                                                    </div>
                                                </div>
                                                <div class="model-card" data-model-repo-id="llama3-70b-q4">
                                                    <div class="model-info">
                                                        <span class="model-name">Llama 3 70B Instruct (Q4_K_M)</span>
                                                        <span class="model-file-size">大小: 38.5GB</span>
                                                    </div>
                                                    <div class="model-actions">
                                                        <button class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                                                    </div>
                                                </div>
                                                <div class="model-card" data-model-repo-id="llama3-70b-q5">
                                                    <div class="model-info">
                                                        <span class="model-name">Llama 3 70B Instruct (Q5_K_M)</span>
                                                        <span class="model-file-size">大小: 42.3GB</span>
                                                    </div>
                                                    <div class="model-actions">
                                                        <button class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Qwen2 模型组 -->
                                        <div class="model-group">
                                            <h3 class="model-group-title">Qwen2</h3>
                                            <div class="settings-container">
                                                <div class="model-card" data-model-repo-id="qwen2-7b-q4">
                                                    <div class="model-info">
                                                        <span class="model-name">Qwen2 7B Instruct (Q4_K_M)</span>
                                                        <span class="model-file-size">大小: 4.1GB</span>
                                                    </div>
                                                    <div class="model-actions">
                                                        <button class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                                                    </div>
                                                </div>
                                                <div class="model-card" data-model-repo-id="qwen2-7b-q5">
                                                    <div class="model-info">
                                                        <span class="model-name">Qwen2 7B Instruct (Q5_K_M)</span>
                                                        <span class="model-file-size">大小: 4.7GB</span>
                                                    </div>
                                                    <div class="model-actions">
                                                        <button class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                                                    </div>
                                                </div>
                                                <div class="model-card" data-model-repo-id="qwen2-72b-q4">
                                                    <div class="model-info">
                                                        <span class="model-name">Qwen2 72B Instruct (Q4_K_M)</span>
                                                        <span class="model-file-size">大小: 39.2GB</span>
                                                    </div>
                                                    <div class="model-actions">
                                                        <button class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Yi 模型组 -->
                                        <div class="model-group">
                                            <h3 class="model-group-title">Yi</h3>
                                            <div class="settings-container">
                                                <div class="model-card" data-model-repo-id="yi-6b-q4">
                                                    <div class="model-info">
                                                        <span class="model-name">Yi 6B Chat (Q4_K_M)</span>
                                                        <span class="model-file-size">大小: 3.6GB</span>
                                                    </div>
                                                    <div class="model-actions">
                                                        <button class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                                                    </div>
                                                </div>
                                                <div class="model-card" data-model-repo-id="yi-6b-q5">
                                                    <div class="model-info">
                                                        <span class="model-name">Yi 6B Chat (Q5_K_M)</span>
                                                        <span class="model-file-size">大小: 4.2GB</span>
                                                    </div>
                                                    <div class="model-actions">
                                                        <button class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                                                    </div>
                                                </div>
                                                <div class="model-card" data-model-repo-id="yi-34b-q4">
                                                    <div class="model-info">
                                                        <span class="model-name">Yi 34B Chat (Q4_K_M)</span>
                                                        <span class="model-file-size">大小: 19.8GB</span>
                                                    </div>
                                                    <div class="model-actions">
                                                        <button class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Mistral 模型组 -->
                                        <div class="model-group">
                                            <h3 class="model-group-title">Mistral</h3>
                                            <div class="settings-container">
                                                <div class="model-card" data-model-repo-id="mistral-7b-q4">
                                                    <div class="model-info">
                                                        <span class="model-name">Mistral 7B Instruct (Q4_K_M)</span>
                                                        <span class="model-file-size">大小: 4.1GB</span>
                                                    </div>
                                                    <div class="model-actions">
                                                        <button class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                                                    </div>
                                                </div>
                                                <div class="model-card" data-model-repo-id="mistral-7b-q5">
                                                    <div class="model-info">
                                                        <span class="model-name">Mistral 7B Instruct (Q5_K_M)</span>
                                                        <span class="model-file-size">大小: 4.8GB</span>
                                                    </div>
                                                    <div class="model-actions">
                                                        <button class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Phi3 模型组 -->
                                        <div class="model-group">
                                            <h3 class="model-group-title">Phi 3</h3>
                                            <div class="settings-container">
                                                <div class="model-card" data-model-repo-id="phi3-mini-q4">
                                                    <div class="model-info">
                                                        <span class="model-name">Phi 3 Mini 4K Instruct (Q4_K_M)</span>
                                                        <span class="model-file-size">大小: 2.7GB</span>
                                                    </div>
                                                    <div class="model-actions">
                                                        <button class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                                                    </div>
                                                </div>
                                                <div class="model-card" data-model-repo-id="phi3-mini-q5">
                                                    <div class="model-info">
                                                        <span class="model-name">Phi 3 Mini 4K Instruct (Q5_K_M)</span>
                                                        <span class="model-file-size">大小: 3.2GB</span>
                                                    </div>
                                                    <div class="model-actions">
                                                        <button class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 已下载模型 -->
                                <div id="downloaded-models" class="offline-model-tab-content">
                                    <div class="settings-container" id="offline-models-container">
                                        <!-- 离线模型列表 - 示例静态内容 -->
                                        <div class="model-card placeholder-card" data-model-id="placeholder-offline-1">
                                            <div class="model-info">
                                                <span class="model-name">示例已下载模型 (qwen-7b-chat.gguf)</span>
                                                <span class="model-path">路径: /path/to/models/qwen-7b-chat.gguf</span>
                                            </div>
                                            <div class="model-actions">
                                                <button class="delete-btn">删除</button>
                                            </div>
                                        </div>
                                        <div class="empty-state" style="display: none;">
                                            <p>还没有已下载的离线模型。</p>
                                        </div>
                                    </div>
                                    <div class="offline-model-actions">
                                        <button class="add-model-btn" id="import-local-model">
                                            <i class="ri-folder-open-line"></i> 导入本地模型
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 向量模型设置 -->
                        <div id="vector-models" class="settings-tab-content">
                            <div class="vector-models-header">
                                <h3>向量模型</h3>
                                <p class="vector-models-description">向量模型用于文本嵌入和语义搜索，支持手动导入或下载默认模型</p>
                            </div>
                            <div class="settings-container" id="vector-models-container">
                                <!-- BGE-Large-ZH 模型 -->
                                <div class="model-card" data-model-id="bge-large-zh">
                                    <div class="model-info">
                                        <span class="model-name">BGE-Large-ZH</span>
                                        <span class="model-path">路径: /Users/username/.grovestudio/vectors/bge-large-zh</span>
                                        <span class="model-status">状态: 未下载</span>
                                    </div>
                                    <div class="model-actions">
                                        <form action="/api/vector-models/download" method="post" class="download-form">
                                            <input type="hidden" name="modelId" value="bge-large-zh">
                                            <input type="hidden" name="modelName" value="BGE-Large-ZH">
                                            <button type="submit" class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                                        </form>
                                        <form action="/api/vector-models/delete" method="post" class="delete-form" style="display: none;">
                                            <input type="hidden" name="modelId" value="bge-large-zh">
                                            <button type="submit" class="delete-btn">删除</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="vector-model-actions">
                                <button class="add-model-btn" id="import-vector-model">
                                    <i class="ri-folder-open-line"></i> 导入本地向量模型
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 弹窗模板 - 添加在线模型 -->
    <template id="add-online-model-template">
        <div class="modal-content">
            <h3>添加在线模型</h3>
            <form id="add-online-model-form">
                <div class="form-group">
                    <label for="model-name">名称</label>
                    <input type="text" id="model-name" required>
                </div>
                <div class="form-group">
                    <label for="model-provider">提供商</label>
                    <select id="model-provider" required>
                        <option value="">请选择提供商</option>
                        <option value="openai">OpenAI</option>
                        <option value="claude">Claude</option>
                        <option value="minimax">MiniMax</option>
                        <option value="baidu">百度文心</option>
                        <option value="custom">自定义</option>
                    </select>
                </div>
                <div class="form-group" id="model-id-group">
                    <label for="model-id">模型ID</label>
                    <input type="text" id="model-id">
                </div>
                <div class="form-group">
                    <label for="api-key">API密钥</label>
                    <input type="password" id="api-key" required>
                </div>
                <div class="form-group" id="base-url-group">
                    <label for="base-url">基础URL(可选)</label>
                    <input type="text" id="base-url">
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-btn" data-action="close">取消</button>
                    <button type="submit" class="save-btn">保存</button>
                </div>
            </form>
        </div>
    </template>

    <!-- 弹窗模板 - 下载模型 -->
    <template id="download-model-template">
        <div class="modal-content">
            <h3>下载模型</h3>
            <div class="model-search-container">
                <input type="text" id="model-search" placeholder="搜索Hugging Face兼容模型...">
                <button id="search-model-btn"><i class="ri-search-line"></i></button>
            </div>
            <div class="model-search-results" id="model-search-results">
                <!-- 搜索结果 - 示例静态内容 -->
                 <div class="search-result-item placeholder-item" data-repo-id="placeholder-search-1">
                    <div class="result-info">
                        <span class="result-name">示例搜索结果模型</span>
                        <span class="result-author">作者</span>
                    </div>
                    <button class="download-btn"><i class="ri-download-2-line"></i> 下载</button>
                </div>
                <div class="empty-state" style="display: none;">
                    <p>未找到相关模型。</p>
                </div>
            </div>
            <div class="download-info" id="download-info" style="display: none;">
                <h4>正在下载模型: <span id="downloading-model-name"></span></h4>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="download-progress"></div>
                </div>
                <p id="download-status">准备下载...</p>
            </div>
            <div class="form-actions">
                <button type="button" class="cancel-btn" data-action="close">取消</button>
            </div>
        </div>
    </template>

    <!-- 弹窗模板 - 下载中模型 -->
    <template id="downloading-models-template">
        <div class="modal-content">
            <h3>下载中的模型</h3>
            <div class="downloading-models-list" id="downloading-models-list">
                <!-- 下载中模型列表 - 示例静态内容 -->
                 <div class="download-item placeholder-item" data-download-id="placeholder-download-1">
                    <div class="download-item-content">
                        <div class="download-item-info">
                            <span class="download-model-name">示例下载中模型</span>
                            <span class="download-status-text">50%</span>
                        </div>
                        <div class="progress-bar-container small">
                            <div class="progress-bar" style="width: 50%;"></div>
                        </div>
                    </div>
                    <button class="cancel-download-btn" data-download-id="placeholder-download-1">取消</button>
                </div>
                <div class="empty-downloads" style="display: block;"> <!-- Initially visible -->
                    <div class="empty-icon"><i class="ri-download-cloud-line"></i></div>
                    <p>当前没有正在下载的模型</p>
                </div>
            </div>
            <div class="form-actions centered">
                <button type="button" class="close-btn" data-action="close">关闭</button>
            </div>
        </div>
    </template>

    <!-- 弹窗模板 - 向量模型下载 -->
    <template id="vector-download-template">
        <div class="modal-content">
            <h3>下载向量模型</h3>
            <div class="download-info">
                <h4>正在下载模型: <span id="vector-downloading-name"></span></h4>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="vector-download-progress"></div>
                </div>
                <p id="vector-download-status">准备下载...</p>
            </div>
            <div class="form-actions">
                <button type="button" class="cancel-btn" data-action="cancel-download">取消下载</button>
                <button type="button" class="close-btn" data-action="close">关闭</button>
            </div>
        </div>
    </template>

    <!-- 弹窗模板 - 导入向量模型 -->
    <template id="import-vector-model-template">
        <div class="modal-content">
            <h3>导入向量模型</h3>
            <form id="import-vector-model-form">
                <div class="form-group">
                    <label for="vector-model-name">模型名称</label>
                    <input type="text" id="vector-model-name" required>
                </div>
                <div class="form-group">
                    <label for="vector-model-path">模型文件</label>
                    <div class="file-input-container">
                        <input type="file" id="vector-model-path" accept=".gguf,.bin,.onnx" required>
                        <p class="file-hint">支持的格式: .gguf, .bin, .onnx</p>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-btn" data-action="close">取消</button>
                    <button type="submit" class="save-btn">导入</button>
                </div>
            </form>
        </div>
    </template>

    <script type="module" src="../js/pages/model-management.js"></script>
    <script src="../js/pages/vector-models-handler.js"></script>
</body>
</html> 